# 轮式机器人底盘约束求解

## 机器人假设

- 刚体，忽略内部和轮子的关节和自由度
  - 机器人可用空间中的一个点表示
- 在水平面上运动，总维数为3
  - 空间中的点在水平面上的投影

在HW实际应用中，水平面可弱化为任意平面。

## 坐标系定义

### 1. 两种右手坐标系

![两种右手坐标系](https://wuli.wiki/online/6a0523341e11cd3e.svg)
通过上图左的方式定坐标系，以上图右的方式定旋转正方向。

### 2. 全局坐标系和底盘坐标系

![图片](https://img-blog.csdnimg.cn/20200322121216802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d3cGxvdmVraW1p,size_16,color_FFFFFF,t_70)

- 全局(世界)坐标系I
  - 机器人姿态表示 $X_I=(x_I,y_I,\theta_I)^T$
- 机器人(局部)坐标系R
  - 机器人姿态表示 $X_R=(x_R,y_R,\theta_R)^T$
- 两坐标系关系
  - 位置关系
    - 机器人坐标系一般建立在机器人中心
    - 当不考虑地图构建时，世界坐标系位置不是重点，可以视其原
    - 点和机器人坐标系固联
  - 姿态关系
    - 当不考虑地图构建时，两者Z轴时刻水平且正方向相同
    - 假设 $Oxy{R}$ 由 $I$ 绕 $I_z$ 旋转 $\theta$ 得到，则有速度关系
      $$\dot{X}_R=R(\theta)\dot{X}_I
      =\begin{bmatrix}
      \cos\theta&\sin\theta   &0 \\
      -\sin\theta &\cos\theta  &0    \\
       0&   0  &1
       \end{bmatrix}
       \dot{X}_I
       $$

    - 对遥控器指令进行解码生成速度时，需要明确该速度 $\dot{X}$ 的坐标系

## 作用合成的运动学建模

参考之前的逆运动学文档

## 基于约束的运动学建模

### 前提

标准轮是各类轮子(转向轮、瑞典轮等)的基本部件

### 标准轮存在的约束
![图片](https://pic4.zhimg.com/80/v2-1dd6d29e1f489012ae73a640318944ef_720w.webp)

- 滚动约束 $v_\parallel =r\dot{\varphi }$
  - 轮子在相应方向发生运动时必须转动，即沿着轮平面的所有运动必须通过适当的旋转转量来实现
- 无侧滑约束 $v_\perp=0$
  - 轮子不能在垂直于轮子平面的方向发生滑动，即轮子垂直于轮平面的运动分量必须为0

对于不同的轮进行约束分析，实质上是将 $\dot{X}_R$ 的各个分量通过变换映射到轮的轮平面和法方向，建立满足滚动约束和无侧滑约束的方程或方程组

### 不同轮存在的约束(单轮)

#### 固定标准轮

![图片](https://img-blog.csdnimg.cn/20200324115144397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d3cGxvdmVraW1p,size_16,color_FFFFFF,t_70)
对底盘的角度固定

- 机器人坐标系下，轮A的位姿为 $(l,\alpha,\beta)$
- 滚动约束 $$ \begin{bmatrix}\sin(\alpha+\beta)&-\cos(\alpha+\beta)&(-l)\cos\beta\end{bmatrix}\dot{X}_R-r\dot{\varphi}=0$$
- 无侧滑约束 $$ \begin{bmatrix}\cos(\alpha+\beta)&\sin(\alpha+\beta)&l\sin\beta\end{bmatrix}\dot{X}_R=0$$

#### 转向标准轮

[图片]
转向标准轮可以控制轮子绕穿过轮子中心和地面接触点的垂直轴转向

- 与固定标准轮的区别
  - 主要是对底盘的位置 $\beta(t)$ 不再固定
  - 轮对底盘的位置变化 $\dot{\beta}$ 对机器人当前的运动约束没有影响
- 在时刻 $t$，机器人坐标系下，轮A的位姿为 $(l,\alpha,\beta)$
- 滚动约束 $$ \begin{bmatrix}\sin(\alpha+\beta)&-\cos(\alpha+\beta)&(-l)\cos\beta\end{bmatrix}\dot{X}_R-r\dot{\varphi}=0$$
- 无侧滑约束 $$ \begin{bmatrix}\cos(\alpha+\beta)&\sin(\alpha+\beta)&l\sin\beta\end{bmatrix}\dot{X}_R=0$$

#### 脚轮

[图片]
转向标准轮可以绕穿某一垂直轴转向，但该轴不和地面接触点重合，此外，轮平面始终与AB平齐
[图片]
进行约束求解时，将 $\dot{x}_R、\dot{y}_R、l'\dot{\theta}$分解到轮平面及其法平面方向，此外，转向位置的变化和旋转垂直轴的偏移使得脚轮侧向移动不再为0，要求通过一个等量且相反的转向运动进行平衡，因此在求解无侧滑约束时加入对 $\dot{\beta}$的控制或者生成，使得任意侧向运动变得可行
$$\dot{x}_R*\cos(\alpha+\beta-90)+\dot{y}_R*\sin(\alpha+\beta-90)+l\sin(\beta-90)=r\dot{\varphi}\\
-\dot{x}_R*\sin(\alpha+\beta-90)+\dot{y}_R*\cos(\alpha+\beta-90)+\dot{\theta}_R*(l\sin\beta+d)+d\dot{\beta}=0$$
化简得到
- 滚动约束 $$ \begin{bmatrix}\sin(\alpha+\beta)&-\cos(\alpha+\beta)&(-l)\cos\beta\end{bmatrix}\dot{X}_R-r\dot{\varphi}=0$$
- 无侧滑约束 $$ \begin{bmatrix}\cos(\alpha+\beta)&\sin(\alpha+\beta)&d+l{\sin}\beta\end{bmatrix}\dot{X}_R+d\dot{\beta}=0$$
#### Swedish轮
[图片]
由固定标准轮和附在轮子周围的转子组成，相对于标准轮增加了一个自由度，由于转子的转速是自由的，Swedish轮的无侧滑约束总是能被满足，或者说其无侧滑约束相当于不存在
相比于固定标准轮，Swedish轮多出了一个参数 $\gamma$(主轮平面转向与地面接触的棍子转轴的角度，右手定则确定方向)。

[图片]
- 上述三者的 $\gamma$分别为0度、0度、45度
瑞典轮主轮的滚动约束和无侧滑约束实际上是与地面接触的棍子的无侧滑约束和滚动约束
- 滚动约束 $$ \begin{bmatrix}\sin(\alpha+\beta+\gamma)&-\cos(\alpha+\beta+\gamma)&(-l)\cos(\beta+\gamma)\end{bmatrix}\dot{X}_R-r\dot{\varphi}\cos\gamma=0$$
- 无侧滑约束 $$ \begin{bmatrix}\cos(\alpha+\beta+\gamma)&\sin(\alpha+\beta+\gamma)&l{\sin}(\beta+\gamma)\end{bmatrix}\dot{X}_R-r\dot{\varphi}\sin\gamma-r_{sw}\dot{\varphi}_{sw}=0$$
##### 球轮
[图片]
球轮是一种全方向系统，对于某个剖面来讲，其运动学描述和固定化标准轮完全相同
- 滚动约束 $$ \begin{bmatrix}\sin(\alpha+\beta)&-\cos(\alpha+\beta)&(-l)\cos\beta\end{bmatrix}\dot{X}_R-r\dot{\varphi}=0$$
- 无侧滑约束 $$ \begin{bmatrix}\cos(\alpha+\beta)&\sin(\alpha+\beta)&l\sin\beta\end{bmatrix}\dot{X}_R=0$$
### 轮的运动学约束和运动状态关系
|     轮     | 运动状态 | 滚动约束 | 无侧滑约束 |      控制要求      |
| :--------: | :------: | :------: | :--------: | :----------------: |
| 固定标准轮 |   驱动   |    有    |     有     |      转速控制      |
|            |   随动   |  总满足  |     有     |         无         |
| 转向标准轮 |   驱动   |    有    |     有     | 转速、转轴方向控制 |
|            |   随动   |  总满足  |     有     |         无         |
|    脚轮    |   驱动   |    有    |   总满足   | 转速、转轴方向控制 |
|            |   随动   |  总满足  |   总满足   |         无         |
|   瑞典轮   |   驱动   |    有    |   总满足   |      转速控制      |
|            |   随动   |  总满足  |   总满足   |         无         |
|    球轮    |   驱动   |    有    |     有     | 转速、转轴方向控制 |
|            |   随动   |  总满足  |   总满足   |         无         |

- 驱动状态下
通过轮的全部参数来生成 $\dot{X}_R$
- 随动状态下
通过 $\dot{X}_R$ 来生成轮的部分参数，如转速和转轴方向

但无论在哪个运动状态，都是通过轮的运动约束来生成。

### 机器人的运动学约束
#### 基于标准轮
假设机器人共有N个标准轮，其参数如下
$N_f$ 个固定标准轮，轮子 $N_f\times 1$ 的角度向量 $\beta_f$ ，$N_f\times 1$ 的旋转速度向量 $\dot{\varphi}_f$
$N_s$ 个固定标准轮，轮子 $N_s\times 1$ 角度的向量 $\beta_s$， $N_s\times 1$ 旋转速度的向量 $\dot{\varphi}_s$
则机器人约束可以表示为
$$\begin{pmatrix}
 \mathbf{J_{1}(\beta_s)}\\
\mathbf{C_{1}(\beta_s)}  
\end{pmatrix}
\mathbf{\dot{X}_R}=
\begin{pmatrix}
 \mathbf{J_{2}\dot{\varphi }} \\0  
\end{pmatrix}$$
其中
$$\mathbf{J_{1}}=\begin{pmatrix}
 \mathbf{J_{1f}} \\\mathbf{J_{1s}(\beta_s)}
\end{pmatrix}，\mathbf{C_{1}(\beta)} =\begin{pmatrix}
\mathbf{C_{1f}}\\\mathbf{C_{1s}(\beta_s)}  
\end{pmatrix}，\mathbf{\dot{\varphi }}=\begin{pmatrix}
\mathbf{\dot{\varphi }_f(t)}\\\mathbf{\dot{\varphi }_s(t)}  
\end{pmatrix}$$
其中
$\mathbf{J_{1f}}$ ， $\mathbf{J_{1s}(\beta_s)}$ 分别为 $N_f\times 3$ 和 $N_s\times 3$ 的矩阵 $\mathbf{C_{1f}}$ ，$\mathbf{C_{1s}(\beta_s)}$ 分别为 $N_f\times 3$ 和 $N_s\times 3$ 的矩阵:

$$\mathbf{J_{1f}}=
\begin{bmatrix}\sin(\mathbf{\alpha_{f}}+\mathbf{\beta_{f}})&-\cos(\mathbf{\alpha_{f}}+\mathbf{\beta_{f}})&(-l)\cos\mathbf{\beta_{f}}\end{bmatrix}$$
$$\mathbf{J_{1s}(\beta_s)}=
\begin{bmatrix}\sin(\mathbf{\alpha_{s}}+\mathbf{\beta_{s}})&-\cos(\mathbf{\alpha_{s}}+\mathbf{\beta_{s}})&(-l)\cos\mathbf{\beta_{s}}\end{bmatrix}$$
$$\mathbf{C_{1f}}=
\begin{bmatrix}\cos(\mathbf{\alpha_{f}}+\mathbf{\beta_{f}})&\sin(\mathbf{\alpha_{f}}+\mathbf{\beta_{f}})&l\sin\mathbf{\beta_{f}}\end{bmatrix}$$
$$\mathbf{C_{1s}(\beta_s)}=
\begin{bmatrix}\cos(\mathbf{\alpha_{s}}+\mathbf{\beta_{s}})&\sin(\mathbf{\alpha_{s}}+\mathbf{\beta_{s}})&l\sin\mathbf{\beta_{s}}\end{bmatrix}$$
此处假定所有轮子的 $l$ 都是一致的常数，
其展开为
$\mathbf{J_{1f}}=\begin{bmatrix}\sin(\mathbf{\alpha_{f}}+\mathbf{\beta_{f}})&-\cos(\mathbf{\alpha_{f}}+\mathbf{\beta_{f}})&(-l)\cos\mathbf{\beta_{f}}\end{bmatrix}$
$\mathbf{J_2}为N\times N的对角矩阵，对角元素为各轮的半径$
#### 更一般的约束公式
假设机器人共有N个轮子
以第i个轮子的中心为原点按照右手系建立轮坐标系，其中 $Z_W$ 与 $Z_R$ 平行， $X_W$ 与轮平面平行
从机器人坐标原点指向轮平面中心的距离向量 $l_i$，其与 $X_R$ 正方向的夹角 $\alpha_i$ (右手定则)，与轮法向量夹角为 $\beta_i$ (右手定则)
脚轮接触点的垂直轴与控制轮旋转的转轴距离 $d_i$。
若与地面接触的有棍子，则 $\gamma_i$ 为与地面接触的的轮平面到棍子转轴的夹角， $r_{swi}$ ，$\dot{\varphi} _{swi}$ 分别为与地面接的的棍子的半径和转速，否则都为0。
通过对其滚动约束和无侧滑约束的叠加，则有
$$\begin{bmatrix}
  \sin \left ( \alpha_1 +\beta_1 +\gamma_1  \right ) & -\cos \left ( \alpha_1 +\beta_1 +\gamma_1  \right ) & -l_1\cos \left ( \beta_1 +\gamma_1  \right ) \\
  &  \dots & \\
  \sin \left ( \alpha_N +\beta_N +\gamma_N  \right )& -  \cos \left ( \alpha_N +\beta_N +\gamma_N  \right ) & -l_N\cos \left ( \beta_N +\gamma_N  \right ) \\
 \cos \left ( \alpha_1 +\beta_1 +\gamma_1  \right )&\sin \left ( \alpha_1 +\beta_1 +\gamma_1  \right )&l_1\sin \left ( \beta_1 +\gamma_1  \right )+d_1\dot{\beta} \\
&\dots&\\
\cos \left ( \alpha_N +\beta_N +\gamma_N  \right )&\sin \left ( \alpha_N +\beta_N +\gamma_N  \right )&l_N\sin \left ( \beta_N +\gamma_N  \right )+d_N\dot{\beta}
\end{bmatrix}\mathbf{\dot{X}_R}=\begin{bmatrix}
 r_1\dot{\varphi }_1 \cos \gamma _1\\
 \dots \\
  r_N\dot{\varphi }_N \cos {\gamma _N}\\
 r_1\dot{\varphi }_1\sin \gamma _1+r_{sw1}\dot{\varphi} _{sw1} \\
 \dots\\
 r_N\dot{\varphi }_N\sin \gamma _N+r_{swN}\dot{\varphi} _{swN}
\end{bmatrix}$$
该式很适合于快速搭建矩阵进行矩阵运算
### 运动学约束求解
当作为驱动轮时，需要通过约束方程生成相应的速度和角度控制来达到需要的速度和转速要求
当作为随动轮时，会通过约束方程按照已有的速度和转速情况生成相应的速度和角度结果
#### 矩阵方法
使用支持矩阵和常微分(或进行数值近似)的编程语言可以快速求解
#### 单独求解
由于C语言不支持矩阵计算，故需要对每个轮子进行单独求解
更正：现已知固定标准轮和Swedish轮的矩阵运算可在M4框架上实现，转向标准轮滚动约束的矩阵运算可以在M4框架实现，其无侧滑约束的矩阵运是否被支持算尚未确定，即对形如 $\sin\mathbf{X}$的矩阵(向量)运算的支持尚未确定
假设机器人共有N个轮子
以第i个轮子的中心为原点按照右手系建立轮坐标系，其中 $Z_W$ 与 $Z_R$ 平行， $X_W$ 与轮平面平行
从机器人坐标原点指向轮平面中心的距离向量 $l_i$，其与 $X_R$ 正方向的夹角 $\alpha_i$ (右手定则)，与轮法向量夹角为 $\beta_i$ (右手定则)
脚轮接触点的垂直轴与控制轮旋转的转轴距离 $d_i$。
若与地面接触的有棍子，则 $\gamma_i$ 为与地面接触的的轮平面到棍子转轴的夹角， $r_{swi}$ ，$\dot{\varphi} _{swi}$ 分别为与地面接的的棍子的半径和转速，否则都为0。
则有
$$\begin{bmatrix}
  \sin \left ( \alpha_i +\beta_i +\gamma_i  \right ) & -\cos \left ( \alpha_i +\beta_i +\gamma_i  \right ) & -l_i\cos \left ( \beta_i +\gamma_i  \right ) \\
 \cos \left ( \alpha_i +\beta_i +\gamma_i  \right )&\sin \left ( \alpha_i +\beta_i +\gamma_i  \right )&l_i\sin \left ( \beta_i +\gamma_i  \right )+d_i \dot{\beta} \\
\end{bmatrix}\mathbf{\dot{X}_R}=\begin{bmatrix}
 r_i\dot{\varphi }_i \cos \gamma_i\\
 r_i\dot{\varphi }_i\sin \gamma_i+r_{swi}\dot{\varphi}_{swi}
\end{bmatrix}$$

将矩阵展开，则有
$$\begin{cases}
 \sin \left ( \alpha_i +\beta_i +\gamma_i  \right ) \dot{x}_R
 -\cos \left ( \alpha_i +\beta_i +\gamma_i  \right )\dot{y}_R
 -l_i\cos \left ( \beta_i +\gamma_i  \right )\dot{\theta}_R & = r_i\dot{\varphi }_i\cos {\gamma _i} \\
\cos \left ( \alpha_i +\beta_i +\gamma_i  \right )\dot{x}_R
+\sin \left ( \alpha_i +\beta_i +\gamma_i  \right )\dot{y}_R
+\left (l_i\sin \left ( \beta_i +\gamma_i  \right )+d_i\dot{\beta}  \right ) \dot{\theta}_R & = r_i\dot{\varphi }_i\sin \gamma _i+r_{swi}\dot{\varphi} _{swi}
\end{cases}$$

##### 固定标准轮

对于固定标准轮，变量只有 $\dot{\varphi}_i$，约束方程组可以简化为
$$\begin{cases}
 \sin \left ( \alpha_i +\beta_i  \right ) \dot{x}_R
 -\cos \left ( \alpha_i +\beta_i  \right )\dot{y}_R
 -l_i\cos \left ( \beta_i \right )\dot{\theta}_R & = r_i\dot{\varphi }_i \\
\cos \left ( \alpha_i +\beta_i   \right )\dot{x}_R
+\sin \left ( \alpha_i +\beta_i  \right )\dot{y}_R
+l_i\sin \left ( \beta_i  \right ) \dot{\theta}_R & = 0
\end{cases}$$

从上式可以看出，对于固定标准轮而言，如果需要满足无侧滑约束，机器人坐标系下的速度控制需要满足一定的条件。
并且按照滚动约束结算出来的转速并不一定能满足输入的速度控制。
若只有固定标准轮作为驱动，一般采用两轮差分驱动。

##### 转向标准轮和球轮
若将球轮的水平转轴视作标准轮的法线，则球轮可以视作一个转向标准轮
对于转向标准轮，变量只有 $\dot{\varphi}_i$ 和 $\beta_i$ ，约束方程组可以简化为

$$\begin{cases}
 \left (\dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i \right )\sin \beta _{i} - \left ( \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R \right )\cos\beta _{i}
=r_i\dot{\varphi}_i\\
 \left (\dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i \right )\cos \beta _{i}  - \left ( \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R \right )\sin\beta _{i}
=0
\end{cases}$$

设 $ var_1 = \dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i $ , $var_2 = \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R$，分别通过其无侧滑约束和滚动约束，可以得到

$$\beta_{ref_{i}}=
 \begin{cases} Atan2(var_1,var_2)
 & if \left \| \dot{X}_R  \right \|\neq 0\\
 0 & if \left \| \dot{X}_R  \right \|= 0
\end{cases}$$

$$\dot{\varphi}_i =\frac{ var_1 \sin \beta _{i} - var_2 \cos\beta _{i} }{r_i} $$

##### Swedish轮
对于Swedish轮，变量只有 $\dot{\varphi}_i$ ，约束方程组可以简化为滚动约束方程
$$\sin \left ( \alpha_i +\beta_i +\gamma_i  \right ) \dot{x}_R
 -\cos \left ( \alpha_i +\beta_i +\gamma_i  \right )\dot{y}_R
 -l_i\cos \left ( \beta_i +\gamma_i  \right )\dot{\theta}_R  = r_i\dot{\varphi }_i\cos {\gamma _i}$$
则
$$\dot{\varphi }_i=\frac{
\sin \left ( \alpha_i +\beta_i +\gamma_i  \right ) \dot{x}_R
 -\cos \left ( \alpha_i +\beta_i +\gamma_i  \right )\dot{y}_R
 -l_i\cos \left ( \beta_i +\gamma_i  \right )\dot{\theta}_R}
{r_i\cos\gamma_i}$$
##### 脚轮
对于脚轮，变量只有 $\dot{\varphi}_i$ 和 $\beta_i$ ，约束方程组可以简化为
$$\begin{cases}
 \left (\dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i \right )\sin \beta _{i} - \left ( \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R \right )\cos\beta _{i}
=r_i\dot{\varphi}_i
\\
 \left (\dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i \right )\cos \beta _{i} - \left ( \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R \right )\sin\beta _{i} +d_i\dot{\beta}_i
=0
\end{cases}$$
简化其无侧滑约束为
$$a_i\cos\beta_i+b_i\sin\beta_i+d_i\dot\beta_i=0$$
其中， $a_i$ 、 $b_i$ 、 $d_i$ 为常数
 $a_i=\dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i ，b_i=- \left ( \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R \right )$
则有， $$\dot{\beta }_i= \frac{\mathrm{d}\beta _i }{\mathrm{d}t } =-\frac{a_i\cos\beta_i+b_i\sin\beta_i}{d_i} $$
即 $$-\frac{\mathrm{d}\beta_i }{a_i\cos\beta_i+b_i\sin\beta_i} =\frac{\mathrm{d}t }{d_i} $$
分别对左右两边积分
 $$\int -\frac{\mathrm{d}\beta_i }{a_i\cos\beta_i+b_i\sin\beta_i} =\int \frac{\mathrm{d}t }{d_i} =\frac{\bigtriangleup  t}{d_i} $$
因为 $$\cos \beta _i = \frac{1-\tan ^{2} \frac{\beta _i}{2} }{1+\tan ^{2 } \frac{\beta _i}{2}} ,\space
\sin \beta _i = \frac{\tan \frac{\beta_i }{2} }{1+\tan ^{2} \frac{\beta _i}{2}} $$
则令 $\tan \frac{\beta _i }{2}=t_i,\space  \mathrm{d}\beta _i=2\cdot \frac{1}{1+t_i^{2} } \mathrm{d}t_i $
则 
$$\begin{align*}
\int -\frac{\mathrm{d}\beta_i }{a_i\cos\beta_i+b_i\sin\beta_i} &=\int {\frac{2\mathrm{d}t_{i} }{a_it_i^2-2b_it_i-a_i} }\\
&=\int {\frac{2\mathrm{d}t _i}{\frac{a_i^2+b_i^2}{a_i}\left
[ \frac{a_i^2}{a_i^2+b_i^2} \left ( t_i-\frac{b_i}{a_i}  \right ) ^2 -1\right ]  } }\\
&=\frac{2a_i}{a_i^2+b_i^2} \int {\frac{\mathrm{d}t _i}{\left [
\frac{a_i}{\sqrt{a_i^2+b_i^2} }\left ( t_i-\frac{b_i}{a_i}  \right )
 \right ] ^2-1} }
\end{align*}$$
令 $m_i=\frac{a_i}{\sqrt{a_i^2+b_i^2} }\left ( t_i-\frac{b_i}{a_i}  \right ) ,\mathrm{d}t _i=\frac{\sqrt{a_i^2+b_i^2} }{a_i}\mathrm{d}m_i $
则 
$$\begin{align*}
\int -\frac{\mathrm{d}\beta_i }{a_i\cos\beta_i+b_i\sin\beta_i} &=\frac{2}{\sqrt{a_i^2+b_i^2}} \int \frac{\mathrm{d}m_i }{m_i^2-1} \\
&=\frac{1}{\sqrt{a_i^2+b_i^2}} \int \left (  
\frac{1}{m_i-1}- \frac{1}{m_i+1}
\right ) \mathrm{d}m_i \\
&=\frac{1}{\sqrt{a_i^2+b_i^2}}\ln_{}{\frac{m_i-1}{m_i+1} } +C
\end{align*}$$
即 $\frac{1}{\sqrt{a_i^2+b_i^2}}\ln_{}{\frac{m_i-1}{m_i+1} } +C=\frac{\bigtriangleup  t}{d_i} $
即 $m_i=\frac{1+\exp c_i}{1-\exp c_i},c_i=\sqrt{a_i^2+b_i^2} \left ( \frac{\bigtriangleup  t}{d_i} -C \right )$
又因为 $m_i= \frac{a_i}{\sqrt{a_i^2+b_i^2} }\left ( t_i-\frac{b_i}{a_i}  \right ) ,\tan \frac{\beta _i }{2}$
所以 $$\beta_i=2\arctan {\frac{\sqrt{a_i^2+b_i^2}m_i+b_i }{a_i} }$$

**如何消去常数项 $C$**
现假设采样时间间隔为 $\bigtriangleup  t$，已知当前的初始值 $\beta_{i0}$
则 $$C=-\frac{1}{\sqrt{a_i^2+b_i^2}}\ln_{}{\frac{m_i-1}{m_i+1} } =-\frac{1}{\sqrt{a_i^2+b_i^2}}\ln_{}{\frac{m_{i0}-1}{m_{i0}+1} }$$
将 $\beta_{i0}$ 代入 $m_{i0}= \frac{a_i}{\sqrt{a_i^2+b_i^2} }\left ( \tan \frac{\beta _{i0} }{2}-\frac{b_i}{a_i}  \right ) $ 即可求得常数 $C$
再根据其滚动约束，可以得到
$$\dot{\varphi}_i =\frac{\left (\dot{x}_R \cos \alpha_i + \dot{y}_R\sin \alpha_i \right )\sin \beta _{i} - \left ( \dot{x}_R \sin \alpha_i- \dot{y }_R\cos \alpha_i-l \dot{\theta }_R \right )\cos\beta _{i} }{r_i} $$

因为其控制较复杂，一般脚轮是作随动轮，此外，脚轮 $\beta$ 角变化还会给机器人本身带来一定的转矩影响。

## 参考链接
[right hand rule](https://wuli.wiki//online/RHRul.html)
[introduction to autonomous mobile robots](https://vdoc.pub/download/introduction-to-autonomous-mobile-robots-42fhm17lqoc0)
